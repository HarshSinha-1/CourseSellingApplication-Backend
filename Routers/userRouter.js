const { Router } = require('express');
const {usermodel,purchasemodel,coursemodel} = require("../Models/db");
const {userMiddleware} = require('../middleware/user')
const UserRouter = Router();
const jwt = require('jsonwebtoken');
const {JWT_USER_PASSWORD} = require("../config/config");

UserRouter.post("/signup",async function (req,res){
    const { email,firstname,lastname,password } = req.body;

    const hashpwd = await  bcrypt.hashSync(password,10);

     await usermodel.create({
        email,
        firstname,
        lastname,
        hashpwd
    })
    
    res.json({
        message : "You are signup "
    })
})
UserRouter.post("/login", async function (req,res){
    const { email,password } = req.body;

    const user = await usermodel.findOne({
        email : email ,
    });

    const matchpwd = await bcrypt.compare(password,user.hashpwd);

    if(user && matchpwd){
        const token = await jwt.sign({
            id : user._id
        },JWT_USER_PASSWORD);
    
    res.json({
        token : token
        })
    }else{
        res.status(403).json({
            message :'Incorrect Credentials'
        })
    }
})


module.exports = UserRouter;










































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































